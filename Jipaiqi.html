<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <!-- PWA 配置 -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="麻将计数器">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">

<!-- 图标（iOS 添加到主屏时显示） -->
<link rel="apple-touch-icon" href="icon-192.png" sizes="192x192">
<link rel="apple-touch-icon" href="icon-256.png" sizes="256x256">
<link rel="apple-touch-icon" href="icon-512.png" sizes="512x512">

<!-- 启动画面（可选） -->
<link rel="apple-touch-startup-image" href="splash.png">

<!-- 主题颜色 -->
<meta name="theme-color" content="#d4380d">
  <link rel="manifest" href="manifest.json">
  <title>麻将牌计数器</title>
  <style>
    body {
      font-family: "Microsoft YaHei", Arial, sans-serif;
      text-align: center;
      margin: 20px;
      background-color: #f7f7f7;
    }
    h1 {
      color: #d4380d;
      font-size: 28px;
    }
    .subtitle {
      color: #555;
      font-size: 16px;
    }
    .section-title {
      font-size: 18px;
      font-weight: bold;
      color: #005a9c;
      margin-top: 10px;
      margin-bottom: 5px;
    }
    .container {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin: 30px auto;
      max-width: 1400px;
      flex-wrap: wrap;
    }
    .module {
      background: white;
      border-radius: 12px;
      padding: 15px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.15);
      width: 280px;
      min-height: 380px;
    }
    .counter-box {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      margin-bottom: 10px;
    }
    .counter-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      font-size: 14px;
      transition: all 0.3s ease;
    }
    .counter-item.hidden {
      opacity: 0;
      transform: scale(0.7);
      height: 0;
      overflow: hidden;
      padding: 0;
      margin: 0;
    }
    .counter-label {
      font-weight: bold;
      color: #333;
      margin-bottom: 4px;
    }
    .counter {
      font-size: 28px;
      font-weight: bold;
      color: #e6550d;
      margin: 4px 0;
    }
    button {
      font-size: 14px;
      padding: 6px 10px;
      background-color: #e74c3c;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    button:hover:not(:disabled) {
      background-color: #c0392b;
    }
    .sum-display {
      font-size: 18px;
      font-weight: bold;
      color: #005a9c;
      margin-top: 10px;
      padding: 10px;
      background-color: #f0f8ff;
      border-radius: 8px;
      border: 1px solid #bbdffd;
    }
    .reset-btn {
      margin-top: 20px;
      background-color: #3498db;
      font-size: 18px;
      padding: 12px 25px;
      border-radius: 8px;
      color: white;
      border: none;
      cursor: pointer;
      font-weight: bold;
    }
    .reset-btn:hover {
      background-color: #2980b9;
    }
  </style>
</head>
<body>

  <h1>🀄 麻将牌计数器</h1>
  <p class="subtitle">每种牌共 <strong>4 张</strong>，打出一张减一，打完自动隐藏</p>

  <div class="container" id="modules-container">
    <!-- JavaScript 动态生成 -->
  </div>

  <button class="reset-btn" onclick="resetAll()">🔄 重新洗牌</button>

  <script>
    const totalModules = 3;
    const countersPerModule = 9;
    const initialValue = 4;
    const totalCounter = totalModules * countersPerModule;

    // 所有计数器当前值
    let counters = Array(totalCounter).fill(initialValue);

    // 每组的名称映射
    const labels = [
      // 模块1：万
      '一万', '二万', '三万', '四万', '五万', '六万', '七万', '八万', '九万',
      // 模块2：筒
      '一筒', '二筒', '三筒', '四筒', '五筒', '六筒', '七筒', '八筒', '九筒',
      // 模块3：条（幺鸡特殊）
      '幺鸡', '二条', '三条', '四条', '五条', '六条', '七条', '八条', '九条'
    ];

    // 页面加载生成结构
    window.onload = function () {
      const container = document.getElementById('modules-container');

      const moduleNames = ['万子', '筒子', '条子'];

      for (let m = 0; m < totalModules; m++) {
        const module = document.createElement('div');
        module.className = 'module';

        module.innerHTML = `
          <div class="section-title">${moduleNames[m]}</div>
          <div class="counter-box" id="module-${m}-counters"></div>
          <div class="sum-display" id="sum-${m}">剩余：${9 * initialValue}</div>
        `;

        const counterBox = module.querySelector(`#module-${m}-counters`);
        for (let i = 0; i < countersPerModule; i++) {
          const id = m * 9 + i + 1; // 1~27
          const item = document.createElement('div');
          item.className = 'counter-item';
          item.id = `item-${id}`;
          item.innerHTML = `
            <div class="counter-label">${labels[id - 1]}</div>
            <div class="counter" id="counter${id}">${initialValue}</div>
            <button id="btn${id}" onclick="decrement(${id})">出牌</button>
          `;
          counterBox.appendChild(item);
        }

        container.appendChild(module);
      }

      updateAllSums();
    };

    // 减一函数
    function decrement(id) {
      const index = id - 1;
      if (counters[index] > 0) {
        counters[index]--;
        updateDisplay(id);

        // 更新所属模块总和
        const moduleIndex = Math.floor((id - 1) / 9);
        updateSum(moduleIndex);

        // 如果归零，隐藏
        if (counters[index] === 0) {
          hideItem(id);
        }
      }
    }

    // 更新显示
    function updateDisplay(id) {
      const counterElement = document.getElementById(`counter${id}`);
      counterElement.textContent = counters[id - 1];
    }

    // 隐藏计数器
    function hideItem(id) {
      const item = document.getElementById(`item-${id}`);
      if (item && !item.classList.contains('hidden')) {
        item.classList.add('hidden');
      }
    }

    // 显示计数器（重置时）
    function showItem(id) {
      const item = document.getElementById(`item-${id}`);
      if (item) {
        item.classList.remove('hidden');
      }
    }

    // 更新某模块总和
    function updateSum(m) {
      const start = m * 9;
      const end = start + 9;
      const sum = counters.slice(start, end).reduce((a, b) => a + b, 0);
      document.getElementById(`sum-${m}`).textContent = `剩余：${sum}`;
    }

    // 更新所有模块总和
    function updateAllSums() {
      for (let m = 0; m < 3; m++) {
        updateSum(m);
      }
    }

    // 重置所有
    function resetAll() {
      counters = Array(totalCounter).fill(initialValue);

      for (let i = 1; i <= totalCounter; i++) {
        document.getElementById(`counter${i}`).textContent = initialValue;
        showItem(i); // 恢复显示
      }

      updateAllSums(); // 重算
    }
  </script>

</body>
</html>
